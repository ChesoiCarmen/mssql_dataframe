# Azure Pipelines Continuous Deployment that runs automatically after a pull request is complete. 
# Steps performed are essentially the same as the CI pipeline, but require a comment to be made
# after the pull request before the build continues. Additional the package is uploaded to PyPI.
# TODO: document pull request along with comment that is needed
#
# See Also
# --------
# CONTRIBUTING.md CICD Build Pipelines for a general overview of the CICD process
# continuous_integration.py and continuous_integration.yml for the core of the CI process

parameters:
- name: trigger_cd
  displayName: Trigger Continuous Delivery Approval
  type: boolean
  default: False

pool: 
      vmImage: windows-latest

stages:
  - stage: SetupAgent
    jobs:
      - job: SetupAgent
        steps:
          - template: setup-agent.yml
  - stage: ContinuousIntegration
    jobs:
      - job: ContinuousIntegration
        steps:
          - template: continuous-integration.yml
  - stage: ContinuousDelivery
    jobs:
      - deployment: ContinuousDelivery
        condition: or(eq($[Build.SourceBranch], 'refs/heads/master'), eq(${{ parameters.trigger_cd }}, True))
        environment: deploy
        strategy:
          runOnce:
            deploy:
              steps:
                - template: continuous-delivery.yml
