# CICD Build Pipeline
# https://docs.microsoft.com/en-us/azure/devops/pipelines/?view=azure-devops
# https://docs.microsoft.com/en-us/azure/devops/pipelines/yaml-schema?view=azure-devops&tabs=schema%2Cparameter-schema
# https://docs.microsoft.com/azure/devops/pipelines/languages/python
#
# See also: CICD Build Pipelines

trigger:
- main

# windows image for SQL Server Express to be included
pool: Local Laptop
# pool:
#   vmImage: windows-latest

steps:
# include SQL Server Express
- task: PowerShell@2
  displayName: 'SQL Server Express LocalDB'
  inputs:
    targetType: 'inline'
    script: 'sqllocaldb start mssqllocaldb'

# test using multiple Python versions
- task: UsePythonVersion@0
  inputs:
    versionSpec: '$3.9'
  displayName: 'Use Python 3.9'

# install development and build dependancies
- script: |
    python -m pip install --upgrade pip
    pip install -r requirements-dev.txt
  displayName: 'Install development and build dependancies'

# azure integration with pytest
- script: |
    pip installpytest-azurepipelines
  displayName: 'pytest'

# execute cicd.py script
# - task: PythonScript@0
#   inputs:
#     scriptSource: filePath
#     script: cicd.py
#     arguments: --server=(localdb)\\MSSQLLocalDB